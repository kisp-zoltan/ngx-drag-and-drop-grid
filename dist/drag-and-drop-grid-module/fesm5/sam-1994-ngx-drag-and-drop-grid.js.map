{"version":3,"file":"sam-1994-ngx-drag-and-drop-grid.js","sources":["ng://@sam-1994/ngx-drag-and-drop-grid/lib/sam-drag-and-drop-grid.component.ts","ng://@sam-1994/ngx-drag-and-drop-grid/lib/sam-drag-and-drop-grid.module.ts"],"sourcesContent":["import {\r\n  AfterViewInit,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ContentChildren,\r\n  Directive,\r\n  Input,\r\n  OnChanges,\r\n  QueryList,\r\n  SimpleChanges,\r\n  TemplateRef,\r\n  ViewChild,\r\n  ViewChildren,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport {CdkDrag, CdkDragMove, CdkDropList, CdkDropListGroup, moveItemInArray} from '@angular/cdk/drag-drop';\r\nimport {ViewportRuler} from '@angular/cdk/overlay';\r\n\r\n@Directive({\r\n  selector: '[samDragAndDropListData]'\r\n})\r\nexport class SamDragAndDropListDataDirective {\r\n  constructor(public template: TemplateRef<any>) {\r\n  }\r\n}\r\n\r\n@Directive({selector: '[samContentOutlet]'})\r\nexport class SamDragAndDropListContentOutletDirective {\r\n  constructor(public viewContainer: ViewContainerRef) {\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'sam-drag-and-drop-grid',\r\n  templateUrl: './sam-drag-and-drop-grid.component.html',\r\n  styleUrls: ['./sam-drag-and-drop-grid.component.sass']\r\n})\r\nexport class SamDragAndDropGridComponent implements AfterViewInit, OnChanges {\r\n\r\n  @Input() public items: Array<any>;\r\n  @Input() public columnNumber = 1;\r\n\r\n  @ViewChildren(SamDragAndDropListContentOutletDirective) contentOutlet: QueryList<SamDragAndDropListContentOutletDirective>;\r\n  @ContentChildren(SamDragAndDropListDataDirective) dragAndDropListData: QueryList<SamDragAndDropListDataDirective>;\r\n\r\n  @ViewChild(CdkDropListGroup, {static: true}) listGroup: CdkDropListGroup<CdkDropList>;\r\n  @ViewChild(CdkDropList, {static: true}) placeholder: CdkDropList;\r\n\r\n  public target: CdkDropList;\r\n  public targetIndex: number;\r\n  public source: CdkDropList;\r\n  public sourceIndex: number;\r\n  public activeContainer;\r\n\r\n  private static __isTouchEvent(event: MouseEvent | TouchEvent): event is TouchEvent {\r\n    return event.type.startsWith('touch');\r\n  }\r\n\r\n  private static __isInsideDropListClientRect(dropList: CdkDropList, x: number, y: number) {\r\n    const {top, bottom, left, right} = dropList.element.nativeElement.getBoundingClientRect();\r\n    return y >= top && y <= bottom && x >= left && x <= right;\r\n  }\r\n\r\n  constructor(private changeDetector: ChangeDetectorRef, private viewportRuler: ViewportRuler) {\r\n    this.target = null;\r\n    this.source = null;\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.renderItems();\r\n\r\n    const phElement = this.placeholder.element.nativeElement;\r\n\r\n    phElement.style.display = 'none';\r\n    phElement.parentElement.removeChild(phElement);\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (changes.items) {\r\n\r\n      if (!this.contentOutlet) {\r\n        return;\r\n      }\r\n      this.renderItems();\r\n    }\r\n  }\r\n\r\n  public renderItems() {\r\n    this.changeDetector.detectChanges();\r\n\r\n    this.contentOutlet.toArray().forEach((outlet: SamDragAndDropListContentOutletDirective, index: number) => {\r\n      outlet.viewContainer.clear();\r\n      outlet.viewContainer.createEmbeddedView(\r\n        this.dragAndDropListData.first.template, {\r\n          $implicit: this.items[index],\r\n          index\r\n        });\r\n    });\r\n    this.changeDetector.detectChanges();\r\n  }\r\n\r\n  dragMoved(e: CdkDragMove) {\r\n    const point = this.getPointerPositionOnPage(e.event);\r\n\r\n    this.listGroup._items.forEach(dropList => {\r\n      if (SamDragAndDropGridComponent.__isInsideDropListClientRect(dropList, point.x, point.y)) {\r\n        this.activeContainer = dropList;\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  public enter = (drag: CdkDrag, drop: CdkDropList) => {\r\n    if (drop === this.placeholder) {\r\n      return true;\r\n    }\r\n\r\n    if (drop !== this.activeContainer) {\r\n      return false;\r\n    }\r\n\r\n    const phElement = this.placeholder.element.nativeElement;\r\n    const sourceElement = drag.dropContainer.element.nativeElement;\r\n    const dropElement = drop.element.nativeElement;\r\n\r\n    const dragIndex = Array.from(dropElement.parentElement.children).indexOf(this.source ? phElement : sourceElement);\r\n    const dropIndex = Array.from(dropElement.parentElement.children).indexOf(dropElement);\r\n\r\n    if (!this.source) {\r\n      this.sourceIndex = dragIndex;\r\n      this.source = drag.dropContainer;\r\n\r\n      phElement.style.width = sourceElement.clientWidth + 'px';\r\n      phElement.style.height = sourceElement.clientHeight + 'px';\r\n\r\n      sourceElement.parentElement.removeChild(sourceElement);\r\n    }\r\n\r\n    this.targetIndex = dropIndex;\r\n    this.target = drop;\r\n\r\n    phElement.style.display = '';\r\n    dropElement.parentElement.insertBefore(phElement, (dropIndex > dragIndex\r\n      ? dropElement.nextSibling : dropElement));\r\n\r\n    this.placeholder.enter(drag, drag.element.nativeElement.offsetLeft, drag.element.nativeElement.offsetTop);\r\n    return false;\r\n    // tslint:disable-next-line:semicolon\r\n  };\r\n\r\n  drop() {\r\n    if (!this.target) {\r\n      return;\r\n    }\r\n\r\n    const phElement = this.placeholder.element.nativeElement;\r\n    const parent = phElement.parentElement;\r\n\r\n    phElement.style.display = 'none';\r\n\r\n    parent.removeChild(phElement);\r\n    parent.appendChild(phElement);\r\n    parent.insertBefore(this.source.element.nativeElement, parent.children[this.sourceIndex]);\r\n\r\n    this.target = null;\r\n    this.source = null;\r\n\r\n    if (this.sourceIndex !== this.targetIndex) {\r\n      moveItemInArray(this.items, this.sourceIndex, this.targetIndex);\r\n      this.renderItems();\r\n    }\r\n  }\r\n\r\n  /** Determines the point of the page that was touched by the user. */\r\n  getPointerPositionOnPage(event: MouseEvent | TouchEvent) {\r\n    // `touches` will be empty for start/end events so we have to fall back to `changedTouches`.\r\n    const point = SamDragAndDropGridComponent.__isTouchEvent(event) ? (event.touches[0] || event.changedTouches[0]) : event;\r\n    const scrollPosition = this.viewportRuler.getViewportScrollPosition();\r\n\r\n    return {\r\n      x: point.pageX - scrollPosition.left,\r\n      y: point.pageY - scrollPosition.top\r\n    };\r\n  }\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {\r\n  SamDragAndDropGridComponent,\r\n  SamDragAndDropListContentOutletDirective,\r\n  SamDragAndDropListDataDirective\r\n} from './sam-drag-and-drop-grid.component';\r\nimport {DragDropModule} from '@angular/cdk/drag-drop';\r\nimport {CommonModule} from '@angular/common';\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    SamDragAndDropGridComponent,\r\n    SamDragAndDropListContentOutletDirective,\r\n    SamDragAndDropListDataDirective\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    DragDropModule\r\n  ],\r\n  exports: [\r\n    SamDragAndDropGridComponent,\r\n    SamDragAndDropListContentOutletDirective,\r\n    SamDragAndDropListDataDirective\r\n  ]\r\n})\r\nexport class SamDragAndDropGridModule {\r\n}\r\n"],"names":[],"mappings":"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"}