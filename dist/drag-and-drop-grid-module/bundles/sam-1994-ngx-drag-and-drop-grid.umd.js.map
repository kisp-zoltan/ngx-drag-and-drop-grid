{"version":3,"file":"sam-1994-ngx-drag-and-drop-grid.umd.js","sources":["ng://@sam-1994/ngx-drag-and-drop-grid/lib/sam-drag-and-drop-grid.component.ts","ng://@sam-1994/ngx-drag-and-drop-grid/lib/sam-drag-and-drop-grid.module.ts"],"sourcesContent":["import {\r\n  AfterViewInit,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ContentChildren,\r\n  Directive,\r\n  Input,\r\n  OnChanges,\r\n  QueryList,\r\n  SimpleChanges,\r\n  TemplateRef,\r\n  ViewChild,\r\n  ViewChildren,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport {CdkDrag, CdkDragMove, CdkDropList, CdkDropListGroup, moveItemInArray} from '@angular/cdk/drag-drop';\r\nimport {ViewportRuler} from '@angular/cdk/overlay';\r\n\r\n@Directive({\r\n  selector: '[samDragAndDropListData]'\r\n})\r\nexport class SamDragAndDropListDataDirective {\r\n  constructor(public template: TemplateRef<any>) {\r\n  }\r\n}\r\n\r\n@Directive({selector: '[samContentOutlet]'})\r\nexport class SamDragAndDropListContentOutletDirective {\r\n  constructor(public viewContainer: ViewContainerRef) {\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'sam-drag-and-drop-grid',\r\n  templateUrl: './sam-drag-and-drop-grid.component.html',\r\n  styleUrls: ['./sam-drag-and-drop-grid.component.sass']\r\n})\r\nexport class SamDragAndDropGridComponent implements AfterViewInit, OnChanges {\r\n\r\n  @Input() public items: Array<any>;\r\n  @Input() public columnNumber = 1;\r\n\r\n  @ViewChildren(SamDragAndDropListContentOutletDirective) contentOutlet: QueryList<SamDragAndDropListContentOutletDirective>;\r\n  @ContentChildren(SamDragAndDropListDataDirective) dragAndDropListData: QueryList<SamDragAndDropListDataDirective>;\r\n\r\n  @ViewChild(CdkDropListGroup, {static: true}) listGroup: CdkDropListGroup<CdkDropList>;\r\n  @ViewChild(CdkDropList, {static: true}) placeholder: CdkDropList;\r\n\r\n  public target: CdkDropList;\r\n  public targetIndex: number;\r\n  public source: CdkDropList;\r\n  public sourceIndex: number;\r\n  public activeContainer;\r\n\r\n  private static __isTouchEvent(event: MouseEvent | TouchEvent): event is TouchEvent {\r\n    return event.type.startsWith('touch');\r\n  }\r\n\r\n  private static __isInsideDropListClientRect(dropList: CdkDropList, x: number, y: number) {\r\n    const {top, bottom, left, right} = dropList.element.nativeElement.getBoundingClientRect();\r\n    return y >= top && y <= bottom && x >= left && x <= right;\r\n  }\r\n\r\n  constructor(private changeDetector: ChangeDetectorRef, private viewportRuler: ViewportRuler) {\r\n    this.target = null;\r\n    this.source = null;\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.renderItems();\r\n\r\n    const phElement = this.placeholder.element.nativeElement;\r\n\r\n    phElement.style.display = 'none';\r\n    phElement.parentElement.removeChild(phElement);\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (changes.items) {\r\n\r\n      if (!this.contentOutlet) {\r\n        return;\r\n      }\r\n      this.renderItems();\r\n    }\r\n  }\r\n\r\n  public renderItems() {\r\n    this.changeDetector.detectChanges();\r\n\r\n    this.contentOutlet.toArray().forEach((outlet: SamDragAndDropListContentOutletDirective, index: number) => {\r\n      outlet.viewContainer.clear();\r\n      outlet.viewContainer.createEmbeddedView(\r\n        this.dragAndDropListData.first.template, {\r\n          $implicit: this.items[index],\r\n          index\r\n        });\r\n    });\r\n    this.changeDetector.detectChanges();\r\n  }\r\n\r\n  dragMoved(e: CdkDragMove) {\r\n    const point = this.getPointerPositionOnPage(e.event);\r\n\r\n    this.listGroup._items.forEach(dropList => {\r\n      if (SamDragAndDropGridComponent.__isInsideDropListClientRect(dropList, point.x, point.y)) {\r\n        this.activeContainer = dropList;\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  public enter = (drag: CdkDrag, drop: CdkDropList) => {\r\n    if (drop === this.placeholder) {\r\n      return true;\r\n    }\r\n\r\n    if (drop !== this.activeContainer) {\r\n      return false;\r\n    }\r\n\r\n    const phElement = this.placeholder.element.nativeElement;\r\n    const sourceElement = drag.dropContainer.element.nativeElement;\r\n    const dropElement = drop.element.nativeElement;\r\n\r\n    const dragIndex = Array.from(dropElement.parentElement.children).indexOf(this.source ? phElement : sourceElement);\r\n    const dropIndex = Array.from(dropElement.parentElement.children).indexOf(dropElement);\r\n\r\n    if (!this.source) {\r\n      this.sourceIndex = dragIndex;\r\n      this.source = drag.dropContainer;\r\n\r\n      phElement.style.width = sourceElement.clientWidth + 'px';\r\n      phElement.style.height = sourceElement.clientHeight + 'px';\r\n\r\n      sourceElement.parentElement.removeChild(sourceElement);\r\n    }\r\n\r\n    this.targetIndex = dropIndex;\r\n    this.target = drop;\r\n\r\n    phElement.style.display = '';\r\n    dropElement.parentElement.insertBefore(phElement, (dropIndex > dragIndex\r\n      ? dropElement.nextSibling : dropElement));\r\n\r\n    this.placeholder.enter(drag, drag.element.nativeElement.offsetLeft, drag.element.nativeElement.offsetTop);\r\n    return false;\r\n    // tslint:disable-next-line:semicolon\r\n  };\r\n\r\n  drop() {\r\n    if (!this.target) {\r\n      return;\r\n    }\r\n\r\n    const phElement = this.placeholder.element.nativeElement;\r\n    const parent = phElement.parentElement;\r\n\r\n    phElement.style.display = 'none';\r\n\r\n    parent.removeChild(phElement);\r\n    parent.appendChild(phElement);\r\n    parent.insertBefore(this.source.element.nativeElement, parent.children[this.sourceIndex]);\r\n\r\n    this.target = null;\r\n    this.source = null;\r\n\r\n    if (this.sourceIndex !== this.targetIndex) {\r\n      moveItemInArray(this.items, this.sourceIndex, this.targetIndex);\r\n      this.renderItems();\r\n    }\r\n  }\r\n\r\n  /** Determines the point of the page that was touched by the user. */\r\n  getPointerPositionOnPage(event: MouseEvent | TouchEvent) {\r\n    // `touches` will be empty for start/end events so we have to fall back to `changedTouches`.\r\n    const point = SamDragAndDropGridComponent.__isTouchEvent(event) ? (event.touches[0] || event.changedTouches[0]) : event;\r\n    const scrollPosition = this.viewportRuler.getViewportScrollPosition();\r\n\r\n    return {\r\n      x: point.pageX - scrollPosition.left,\r\n      y: point.pageY - scrollPosition.top\r\n    };\r\n  }\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {\r\n  SamDragAndDropGridComponent,\r\n  SamDragAndDropListContentOutletDirective,\r\n  SamDragAndDropListDataDirective\r\n} from './sam-drag-and-drop-grid.component';\r\nimport {DragDropModule} from '@angular/cdk/drag-drop';\r\nimport {CommonModule} from '@angular/common';\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    SamDragAndDropGridComponent,\r\n    SamDragAndDropListContentOutletDirective,\r\n    SamDragAndDropListDataDirective\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    DragDropModule\r\n  ],\r\n  exports: [\r\n    SamDragAndDropGridComponent,\r\n    SamDragAndDropListContentOutletDirective,\r\n    SamDragAndDropListDataDirective\r\n  ]\r\n})\r\nexport class SamDragAndDropGridModule {\r\n}\r\n"],"names":["Directive","TemplateRef","ViewContainerRef","moveItemInArray","Component","ChangeDetectorRef","ViewportRuler","Input","ViewChildren","ContentChildren","ViewChild","CdkDropListGroup","CdkDropList","NgModule","CommonModule","DragDropModule"],"mappings":";;;;;;;;;;AAAA;QAsBE,yCAAmB,QAA0B;YAA1B,aAAQ,GAAR,QAAQ,CAAkB;SAC5C;;oBALFA,cAAS,SAAC;wBACT,QAAQ,EAAE,0BAA0B;qBACrC;;;;oBAVCC,gBAAW;;QAcb,sCAAC;KAND,IAMC;;QAIC,kDAAmB,aAA+B;YAA/B,kBAAa,GAAb,aAAa,CAAkB;SACjD;;oBAHFD,cAAS,SAAC,EAAC,QAAQ,EAAE,oBAAoB,EAAC;;;;oBAbzCE,qBAAgB;;QAiBlB,+CAAC;KAJD,IAIC;;QAiCC,qCAAoB,cAAiC,EAAU,aAA4B;YAA3F,iBAGC;YAHmB,mBAAc,GAAd,cAAc,CAAmB;YAAU,kBAAa,GAAb,aAAa,CAAe;YAvB3E,iBAAY,GAAG,CAAC,CAAC;YAwE1B,UAAK;;;;;YAAG,UAAC,IAAa,EAAE,IAAiB;gBAC9C,IAAI,IAAI,KAAK,KAAI,CAAC,WAAW,EAAE;oBAC7B,OAAO,IAAI,CAAC;iBACb;gBAED,IAAI,IAAI,KAAK,KAAI,CAAC,eAAe,EAAE;oBACjC,OAAO,KAAK,CAAC;iBACd;;oBAEK,SAAS,GAAG,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,aAAa;;oBAClD,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,aAAa;;oBACxD,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa;;oBAExC,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,KAAI,CAAC,MAAM,GAAG,SAAS,GAAG,aAAa,CAAC;;oBAC3G,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC;gBAErF,IAAI,CAAC,KAAI,CAAC,MAAM,EAAE;oBAChB,KAAI,CAAC,WAAW,GAAG,SAAS,CAAC;oBAC7B,KAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC;oBAEjC,SAAS,CAAC,KAAK,CAAC,KAAK,GAAG,aAAa,CAAC,WAAW,GAAG,IAAI,CAAC;oBACzD,SAAS,CAAC,KAAK,CAAC,MAAM,GAAG,aAAa,CAAC,YAAY,GAAG,IAAI,CAAC;oBAE3D,aAAa,CAAC,aAAa,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;iBACxD;gBAED,KAAI,CAAC,WAAW,GAAG,SAAS,CAAC;gBAC7B,KAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBAEnB,SAAS,CAAC,KAAK,CAAC,OAAO,GAAG,EAAE,CAAC;gBAC7B,WAAW,CAAC,aAAa,CAAC,YAAY,CAAC,SAAS,GAAG,SAAS,GAAG,SAAS;sBACpE,WAAW,CAAC,WAAW,GAAG,WAAW,EAAE,CAAC;gBAE5C,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;gBAC1G,OAAO,KAAK,CAAC;;aAEd,EAAC;YApFA,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;SACpB;;;;;;QAZc,0CAAc;;;;;QAA7B,UAA8B,KAA8B;YAC1D,OAAO,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;SACvC;;;;;;;;QAEc,wDAA4B;;;;;;;QAA3C,UAA4C,QAAqB,EAAE,CAAS,EAAE,CAAS;YAC/E,IAAA,2DAAmF,EAAlF,YAAG,EAAE,kBAAM,EAAE,cAAI,EAAE,gBAA+D;YACzF,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,MAAM,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,CAAC;SAC3D;;;;QAOD,qDAAe;;;QAAf;YACE,IAAI,CAAC,WAAW,EAAE,CAAC;;gBAEb,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,aAAa;YAExD,SAAS,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;YACjC,SAAS,CAAC,aAAa,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;SAChD;;;;;QAED,iDAAW;;;;QAAX,UAAY,OAAsB;YAChC,IAAI,OAAO,CAAC,KAAK,EAAE;gBAEjB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;oBACvB,OAAO;iBACR;gBACD,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;SACF;;;;QAEM,iDAAW;;;QAAlB;YAAA,iBAYC;YAXC,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC;YAEpC,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC,OAAO;;;;;YAAC,UAAC,MAAgD,EAAE,KAAa;gBACnG,MAAM,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;gBAC7B,MAAM,CAAC,aAAa,CAAC,kBAAkB,CACrC,KAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,QAAQ,EAAE;oBACvC,SAAS,EAAE,KAAI,CAAC,KAAK,CAAC,KAAK,CAAC;oBAC5B,KAAK,OAAA;iBACN,CAAC,CAAC;aACN,EAAC,CAAC;YACH,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC;SACrC;;;;;QAED,+CAAS;;;;QAAT,UAAU,CAAc;YAAxB,iBASC;;gBARO,KAAK,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,KAAK,CAAC;YAEpD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO;;;;YAAC,UAAA,QAAQ;gBACpC,IAAI,2BAA2B,CAAC,4BAA4B,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE;oBACxF,KAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;oBAChC,OAAO;iBACR;aACF,EAAC,CAAC;SACJ;;;;QAwCD,0CAAI;;;QAAJ;YACE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAChB,OAAO;aACR;;gBAEK,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,aAAa;;gBAClD,MAAM,GAAG,SAAS,CAAC,aAAa;YAEtC,SAAS,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;YAEjC,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;YAC9B,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;YAC9B,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YAE1F,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YAEnB,IAAI,IAAI,CAAC,WAAW,KAAK,IAAI,CAAC,WAAW,EAAE;gBACzCC,wBAAe,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;gBAChE,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;SACF;;;;;;;QAGD,8DAAwB;;;;;QAAxB,UAAyB,KAA8B;;;gBAE/C,KAAK,GAAG,2BAA2B,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,KAAK;;gBACjH,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC,yBAAyB,EAAE;YAErE,OAAO;gBACL,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,IAAI;gBACpC,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,GAAG;aACpC,CAAC;SACH;;oBAvJFC,cAAS,SAAC;wBACT,QAAQ,EAAE,wBAAwB;wBAClC,6oBAAsD;;qBAEvD;;;;oBAlCCC,sBAAiB;oBAcXC,qBAAa;;;4BAuBlBC,UAAK;mCACLA,UAAK;oCAELC,iBAAY,SAAC,wCAAwC;0CACrDC,oBAAe,SAAC,+BAA+B;gCAE/CC,cAAS,SAACC,yBAAgB,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC;kCAC1CD,cAAS,SAACE,oBAAW,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC;;QA0IxC,kCAAC;KAxJD;;;;;;AChCA;QAUA;SAiBC;;oBAjBAC,aAAQ,SAAC;wBACR,YAAY,EAAE;4BACZ,2BAA2B;4BAC3B,wCAAwC;4BACxC,+BAA+B;yBAChC;wBACD,OAAO,EAAE;4BACPC,mBAAY;4BACZC,uBAAc;yBACf;wBACD,OAAO,EAAE;4BACP,2BAA2B;4BAC3B,wCAAwC;4BACxC,+BAA+B;yBAChC;qBACF;;QAED,+BAAC;KAjBD;;;;;;;;;;;;;;;"}